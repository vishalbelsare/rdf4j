# SPARQL Abstract Syntax Tree

We generate our SPARQL AST with JavaCC from the sparql.jjt file.

## Known issues
JavaCC does not generate all the AST***.java files that we currently have, this probably means that we have added our own java files instead of changing the sparql.jjt file and regenerating the AST.

Many of our existing AST***.java files differ significantly from what JavaCC generates. Many of our AST*** classes extend other AST*** classes, while all the generates AST*** classes just extend `SimpleNode`.

Our `Node` interface and `SimpleNode`class have more methods than the ones generated by JavaCC.

## Guide
You will need [gh](https://cli.github.com) and [ant](https://ant.apache.org) and java.

```
gh repo clone javacc/javacc
cd javacc
ant
chmod +x scripts/jjtree
chmod +x scripts/javacc
cd ../../src/main/java/org/eclipse/rdf4j/query/parser/sparql/ast/
../../../../../../../../../../JavaCC/javacc/scripts/jjtree sparql.jjt 
../../../../../../../../../../JavaCC/javacc/scripts/javacc sparql.jj
rm sparql.jj
cd  ../../../../../../../../../../
rm -rf JavaCC/javacc/
mvn process-resources
```

## Patches

We have several improvements to the generated code that can be applied from Git patch files.

Patches are stored in `./patches/`. They should be applied in order.

To apply a patch you need to be in the root RDF4J directory (where the `.git`directory is). The run:

```
git apply core/queryparser/sparql/JavaCC/patches/01-optimize-SyntaxTreeBuilder.diff
git apply core/queryparser/sparql/JavaCC/patches/02-optimize-SyntaxTreeBuilderTokenManager.diff
```

